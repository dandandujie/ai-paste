const E="modulepreload",S=function(t){return"/"+t},p={},g=function(e,n,s){let c=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),r=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));c=Promise.allSettled(n.map(a=>{if(a=S(a),a in p)return;p[a]=!0;const d=a.endsWith(".css"),y=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${y}`))return;const i=document.createElement("link");if(i.rel=d?"stylesheet":E,d||(i.as="script"),i.crossOrigin="",i.href=a,r&&i.setAttribute("nonce",r),document.head.appendChild(i),d)return new Promise((w,T)=>{i.addEventListener("load",w),i.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${a}`)))})}))}function l(o){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o}return c.then(o=>{for(const r of o||[])r.status==="rejected"&&l(r.reason);return e().catch(l)})},h={id:"default",name:"默认",body:{fontFamily:"微软雅黑, Arial, sans-serif",fontSize:"12pt",lineHeight:"1.6",color:"#333333",paragraphSpacing:"8pt"},headings:{h1:{fontSize:"22pt",fontWeight:"bold",marginTop:"16pt",marginBottom:"8pt",color:"#1a1a1a"},h2:{fontSize:"18pt",fontWeight:"bold",marginTop:"14pt",marginBottom:"6pt",color:"#1a1a1a"},h3:{fontSize:"14pt",fontWeight:"bold",marginTop:"12pt",marginBottom:"4pt",color:"#1a1a1a"},h4:{fontSize:"12pt",fontWeight:"bold",marginTop:"10pt",marginBottom:"4pt",color:"#333333"},h5:{fontSize:"11pt",fontWeight:"bold",marginTop:"8pt",marginBottom:"4pt",color:"#333333"},h6:{fontSize:"10pt",fontWeight:"bold",marginTop:"8pt",marginBottom:"4pt",color:"#666666"}},code:{fontFamily:'Consolas, Monaco, "Courier New", monospace',fontSize:"10pt",backgroundColor:"#f5f5f5",textColor:"#333333",padding:"8px",borderRadius:"4px",enableHighlight:!0},table:{borderWidth:"1px",borderColor:"#dddddd",headerBgColor:"#f0f0f0",headerTextColor:"#333333",cellPadding:"6px",alternateRowBg:!0,alternateRowColor:"#fafafa"},list:{indent:"24pt",bulletStyle:"disc",numberStyle:"decimal",itemSpacing:"4pt"}},u={enabled:!0,autoIntercept:!0,currentPresetId:"default",presets:[h],showNotification:!0,showFloatingPanel:!0};async function m(){const t=await chrome.storage.sync.get("settings");return t.settings?{...u,...t.settings}:(await C(u),u)}async function C(t){await chrome.storage.sync.set({settings:t})}async function _(){const t=await m();return t.presets.find(n=>n.id===t.currentPresetId)||t.presets[0]||h}chrome.runtime.onInstalled.addListener(async()=>{await m(),chrome.contextMenus.create({id:"ai-paste-convert",title:"AI-Paste: 转换选中内容",contexts:["selection"]})});chrome.action.onClicked.addListener(async t=>{if(t!=null&&t.id)try{await chrome.tabs.sendMessage(t.id,{type:"TOGGLE_FLOATING_PANEL"})}catch{console.log("Content script not loaded, injecting...")}});chrome.contextMenus.onClicked.addListener(async(t,e)=>{t.menuItemId==="ai-paste-convert"&&(e!=null&&e.id)&&chrome.tabs.sendMessage(e.id,{type:"MANUAL_CONVERT"})});chrome.runtime.onMessage.addListener((t,e,n)=>(P(t).then(n).catch(s=>{console.error("[AI-Paste] handleMessage failed:",s),n({error:(s==null?void 0:s.message)??"Unknown error"})}),!0));async function P(t){switch(t.type){case"GET_SETTINGS":return m();case"CONVERT_CONTENT":{const e=t.payload;return L(e)}case"WRITE_CLIPBOARD":{const{html:e,plainText:n}=t.payload;return await v(e,n),{success:!0}}default:return null}}async function L(t){const{convertMarkdown:e}=await g(async()=>{const{convertMarkdown:r}=await import("../chunks/markdown-converter-Iq05-mQR.js");return{convertMarkdown:r}},[]),{applyStyles:n}=await g(async()=>{const{applyStyles:r}=await import("../chunks/style-applier-Dvt9MWg5.js");return{applyStyles:r}},[]),s=await _();let c;t.sourceType==="markdown"?c=await e(t.content):c=t.content;const l=n(c,s),o=I(t.content);return{html:l,plainText:o,hasFormula:t.content.includes("$")||t.content.includes("\\(")||t.content.includes("\\[")}}function I(t){return t.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim()}let f=!1;async function v(t,e){if(!f)try{await chrome.offscreen.createDocument({url:chrome.runtime.getURL("src/offscreen/index.html"),reasons:[chrome.offscreen.Reason.CLIPBOARD],justification:"Write formatted content to clipboard"}),f=!0}catch(n){if(!n.message.includes("already exists"))throw n;f=!0}await chrome.runtime.sendMessage({target:"offscreen",type:"CLIPBOARD_WRITE",data:{html:t,plainText:e}})}
